<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>官方充值平台</title>
    <meta content="webkit" name="renderer">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0"
          name="viewport">
    <link href="/dist/layuiadmin/layui/css/layui.css" media="all" rel="stylesheet">
    <link href="/dist/layuiadmin/style/admin.css" media="all" rel="stylesheet">
    <link href="/dist/layuiadmin/style/login.css" media="all" rel="stylesheet">

    <style type="text/css">
        .pay-bank-on {
            border: 2px solid #e4393c;
        }
        h3 {
            text-align: left;
            font-weight: bold;
        }
    </style>

</head>
<body>

<div class="layadmin-user-login layadmin-user-display-show" id="LAY-user-login" style="display: none;">
    <div class="layadmin-user-login-main">
        <div class="layadmin-user-login-box layadmin-user-login-header">
            <h2>您正在充值</h2>
            <h3>金额：[[$money]]元</h3>
            <h3>单号：[[$order_sn]]</h3>
        </div>
        <div class="layadmin-user-login-box layadmin-user-login-body layui-form">

            [[foreach name="$banks" item="vo"]]
            <div class="layui-row" onclick="selectBank('[[$vo.bank_code]]')" id="[[$vo.bank_code]]-row">;
                <div class="layui-col-xs10 layui-col-xs-offset1">
                    <img class="bank-ccb-img" src="[[$Think.SERVER_URL]]/[[$vo.bank_logo]]" style="max-width: 100%; max-height: 100%"/>
                </div>
            </div>
            [[/foreach]]


            <div class="layui-form-item"></div>

            <div class="layui-form-item">
                <button class="layui-btn layui-btn-fluid" lay-filter="LAY-pay-cashier" lay-submit>充 值</button>
            </div>
        </div>

        <div class="layui-trans layadmin-user-login-footer">
            <p>© 2018</p>
        </div>
    </div>

</div>


<script src="/dist/layuiadmin/layui/layui.js"></script>
<script src="/static/admin/js/func.js"></script>
<script src="/js/global.js"></script>
<script src="/js/md5.js"></script>
<script src="/js/func.js"></script>

<script>
    // 选择银行
    var preSelectBank = null;

    function selectBank(targetId) {
        var $ = layui.jquery;

        var row = "-row";
        var selected_row = targetId + row;
        $("#" + selected_row).addClass("pay-bank-on");
        if (preSelectBank != null && preSelectBank != targetId) {
            $("#" + preSelectBank + row).removeClass("pay-bank-on");
        }
        preSelectBank = targetId;
    }
</script>

<script>
    layui.use(['jquery', 'layer', 'form'], function () {
        var $ = layui.jquery;
        var form = layui.form;
        var layer = layui.layer;

        form.render();

        //提交
        form.on('submit(LAY-pay-cashier)', function (obj) {

            if (!preSelectBank) {
                alertWarning('请选择银行');
                return;
            }

            ajax({
                url: "[[$Think.ADMIN_URL]]/pay/create",
                data: {
                    money: [[$money]],
                    order_sn: "[[$order_sn]]",
                    bank: preSelectBank
                },
                success: function (res) {
                    if (res.code !== '0') {
                        alertError(res.msg);
                        return;
                    }

                    location.href = res.data.url;
                }

            });

        });

    });
</script>
</body>
</html>