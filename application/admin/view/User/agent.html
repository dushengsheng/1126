<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>我的代理</title>
    <meta content="webkit" name="renderer">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport">
    <link href="/dist/layuiadmin/layui/css/layui.css" media="all" rel="stylesheet">
</head>
<body>

<div style="padding: 20px; background-color: #F2F2F2;">
    <div class="layui-card">
        <div class="layui-card-header">
            <div class="layui-row">
                <div class="layui-col-md6">
                    <span><b>代理列表</b></span>
                </div>
                <div class="layui-col-md1 layui-col-md-offset5">
                    <span class="layui-btn layui-btn-radius layui-btn-normal layui-btn-sm">新增下级代理</span>
                </div>
            </div>
        </div>
        <div class="layui-card-body">
            <form action="" class="layui-form" id="searchForm">
                <div class="layui-form-item" style="text-align: right">
                    <div class="layui-inline">
                        <label class="layui-form-label" style="width:40px;">分组</label>
                        <div class="layui-input-inline" style="width:100px;">
                            <select id="s_gid" name="s_gid">
                                <option value="0">全部</option>
                                [[foreach name="$sys_group" item="vo" key="skey"]]
                                <option value="[[$skey]]">[[$vo]]</option>
                                [[/foreach]]
                            </select>
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label" style="width:40px;">在线</label>
                        <div class="layui-input-inline" style="width:100px;">
                            <select id="s_is_online" name="s_is_online">
                                <option value="all">全部</option>
                                [[foreach name="'yes_or_no'|getConfig" item="vo" key="skey"]]
                                <option value="[[$skey]]">[[$vo]]</option>
                                [[/foreach]]
                            </select>
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">用户名</label>
                        <div class="layui-input-inline">
                            <input autocomplete="off" class="layui-input" name="title" placeholder="用户名" type="text">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <div class="layui-input-inline">
                            <span class="layui-btn layui-btn-radius layui-btn-normal" id="searchBtn">查询</span>
                        </div>
                    </div>
                </div>
            </form>

            <table class="layui-hide" id="userAgent"></table>
        </div>
    </div>
</div>


<script src="/dist/layuiadmin/layui/layui.js"></script>
<script src="/static/admin/js/func.js"></script>
<script src="/js/global.js"></script>
<script src="/js/func.js"></script>

<!--item操作工具条-->
<script type="text/html" id="barItemAct">
    {{#if(d.del==1){}}
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
    {{#}}}
    {{#if(d.kick==1){}}
    <a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="kick">踢下线</a>
    {{#}}}
    {{#if(d.edit==1){}}
    <a class="layui-btn layui-btn-xs layui-btn-primary" lay-event="edit">编辑</a>
    {{#}}}
    {{#if(d.pay==1){}}
    <a class="layui-btn layui-btn-xs" lay-event="recharge">充值</a>
    {{#}}}
</script>


<script>
    layui.config({
        base: '/dist/layuiadmin/' //静态资源所在路径
    }).extend({
        index: 'lib/index' //主入口模块
    }).use(['table', 'jquery', 'index', 'form'], function () {
        var $ = layui.jquery;
        var table = layui.table;
        var form = layui.form;



        function onAgentList() {
            dataPage({
                elem: '#userAgent',
                url: global.admin_url + 'user/agentlist',
                page: true,
                cols: [[
                    {field: 'id', title: 'ID'},
                    {field: 'gname', title: '账号/分组', templet: function (d) {
                            return d.account + '<br/>' + d.gname;
                        }},
                    {field: 'paccount', title: '上级代理', templet: function (d) {
                            if (d.paccount) {
                                return d.paccount;
                            } else {
                                return '';
                            }
                        }},
                    {field: 'balance', title: '可提余额'},
                    {field: 'sx_balance', title: '接单余额'},
                    {field: 'fz_balance', title: '冻结中'},
                    {field: 'td_money', title: '今日收款', templet:function (d) {
                            if (d.gid < 81) {
                                return '/';
                            }
                            var html = '<div style="text-align:left;line-height:18px;">';
                            html += '<div>金额：<b>' + d.td_money_ok + '</b>/<b>' + d.td_money + '</b></div>';
                            html += '<div>订单：<b>' + d.td_cnt_ok + '</b>/<b>' + d.td_cnt + '</b></div>';
                            html += '<div>成功：<b>' + d.td_percent + '<b></div>';
                            html += '</div>';
                            return html;
                        }},
                    {field: 'all_money', title: '累计收款', templet:function (d) {
                            if (d.gid < 81) {
                                return '/';
                            }
                            var html = '<div style="text-align:left;line-height:18px;">';
                            html += '<div>金额：<b>' + d.all_money_ok + '</b> / <b>' + d.all_money + '</b></div>';
                            html += '<div>订单：<b>' + d.all_cnt_ok + '</b> / <b>' + d.all_cnt + '</b></div>';
                            html += '<div>成功：<b>' + d.all_percent + '<b></div>';
                            html += '</div>';
                            return html;
                        }},
                    {field:'status_flag', title: '状态', templet: function (d) {
                            var online_status = '离线';
                            if (d.is_online) online_status = '抢单中';
                            return d.status_flag + '<br/>' + online_status;
                        }},
                    {field:'', align:'center', title:'操作', toolbar:'#barItemAct'}
                ]],
                done:function(res, curr, count) {
                    console.log(res);
                    if($('.sumLine').length < 1) {
                        var html = '<div class="sumLine">';
                        html += '<span>用户数：' + res.data.count + '</span>';
                        html += '<span>可提余额：' + res.data.balance + '</span>';
                        html += '<span>接单余额：' + res.data.sx_balance + '</span>';
                        html += '<span>应回款：' + res.data.kb_balance + '</span>';
                        html += '</div>';
                        $('.layui-table-header').before(html);
                    }
                }
            });
        }


        $('#searchBtn').on('click', function () {
            _alert('this is a click search');
        })

    });
</script>

</body>
</html>
